# Руководство по стилю кода проекта Battler

Этот документ описывает принятые стандарты кодирования для проекта Battler. Следование этим правилам помогает обеспечить согласованность, читаемость и поддерживаемость кода.

## 1. Общие принципы и форматирование

*   **Язык:** Весь код, комментарии и docstrings пишутся на русском языке.
*   **PEP 8:** Неукоснительно соблюдаем рекомендации [PEP 8](https://peps.python.org/pep-0008/).
*   **Длина строки:** Максимальная длина строки — **120 символов**.
*   **Отступы:** 4 пробела на уровень отступа.
*   **Пробелы:** Следовать PEP 8 (пробелы вокруг операторов, после запятых и т.д.).
*   **Пустые строки:** Используем пустые строки для разделения логических блоков внутри функций/методов и между определениями классов/функций.
*   **f-strings:** Предпочитать использование f-strings для форматирования строк.
*   **Магические числа:** Избегать "магических чисел". Все константы должны быть именованными и вынесены на уровень модуля.

## 2. Именование

*   **Переменные, функции, методы:** `snake_case` (например, `calculate_damage`).
*   **Приватные атрибуты/методы:** `_private_snake_case` (одно подчеркивание в начале).
*   **Классы:** `PascalCase` (например, `BattleManager`).
*   **Константы:** `UPPER_CASE_WITH_UNDERSCORES` (например, `DEFAULT_HEALTH`).

## 3. Структура файла

Файлы должны следовать этой структуре сверху вниз:

1.  **Docstring модуля:** Подробно описывает назначение модуля.
2.  **Импорты:** Группируются и сортируются по алфавиту в следующем порядке:
    *   Стандартная библиотека (`json`, `os`, `typing`).
    *   Сторонние библиотеки (`curses`).
    *   Локальные импорты из проекта (`from game.protocols import ...`).
    *   Импорты внутри `if TYPE_CHECKING:`.
3.  **Константы модуля.**
4.  **Классы и функции.**

**Пример структуры импортов:**
```python
"""Краткое описание модуля."""

import json
from typing import List, Dict

import curses

from game.entities.character import Character
from game.systems.events import Event

if TYPE_CHECKING:
    from game.ui.screen import Screen
```

## 4. Комментарии и Docstrings

*   **Docstrings:** Обязательны для всех публичных модулей, классов, функций и методов.
*   **Стиль:** Google. Описывать `Args` для каждого параметра, `Returns` для возвращаемого значения и `Raises` для исключений.

**Пример Docstring:**
```python
def calculate_damage(attacker: Character, target: Character, base_damage: int) -> int:
    """Рассчитывает итоговый урон с учетом защиты цели.

    Args:
        attacker: Атакующий персонаж.
        target: Цель атаки.
        base_damage: Базовый урон до учета защиты.

    Returns:
        Итоговый урон после применения защиты.

    Raises:
        ValueError: Если базовый урон отрицательный.
    """
    if base_damage < 0:
        raise ValueError("Базовый урон не может быть отрицательным.")
    # ... логика расчета ...
```

## 5. Обработка ошибок

*   **Исключения:** Предпочитать встроенные исключения (`ValueError`, `TypeError`). Создавать кастомные исключения, унаследованные от `Exception`, для специфичных ошибок домена.
*   **Блоки `try/except`:** Использовать для обработки ожидаемых ошибок. Не подавлять исключения без логирования или обработки.

## 6. Принципы проектирования

*   **SOLID, DRY, KISS, YAGNI:** Следовать этим фундаментальным принципам для создания чистого, поддерживаемого и простого кода.
*   **Принцип единственной ответственности (SRP):** Каждый класс или функция должны решать одну четко определенную задачу.
*   **Инверсия зависимостей (DI):** Зависимости должны передаваться извне (через конструктор или методы), а не создаваться внутри класса. Это упрощает тестирование и переиспользование.
*   **Композиция поверх наследования:** Предпочитать композицию объектов наследованию для достижения гибкости.

## 7. Рабочий процесс с Git

*   **Ветки:**
    *   `main` — стабильная ветка. Прямые коммиты в `main` запрещены.
    *   `develop` — основная ветка для разработки.
    *   `feature/<name>` — ветки для новой функциональности (например, `feature/inventory-system`).
    *   `fix/<name>` — ветки для исправления ошибок (например, `fix/battle-crash`).
*   **Коммиты:**
    *   Сообщения коммитов должны быть на английском языке и следовать формату **Conventional Commits**.
    *   Формат: `<type>: <description>` (например, `feat: Add inventory screen` или `fix: Correct damage calculation`).
    *   Типы: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`.
*   **Pull Requests (PR):**
    *   Все изменения вливаются в `develop` через Pull Requests.
    *   PR должен иметь осмысленное описание и ссылаться на соответствующую задачу.
    *   Для вливания PR требуется как минимум один апрув от другого члена команды.

## 8. Тестирование

*(Этот раздел будет дополнен, когда потребуется)*
